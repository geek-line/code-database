<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='/node_modules/materialize-css/dist/css/materialize.min.css'>
    <link rel='stylesheet' href='/static/css/user_details.css/'>
</head>
<body>
    {{ template "header" .Header }}


    <div class= "content_page">
        <ul class="tags">   
            {{ range .DetailPage.SelectedTagNames }}
             <li><a href='#'>{{ . }}</a></li>
            {{ end }}
        </ul>
        <div class= "title"><h2>{{ .DetailPage.Title }}</h2></div>
        <div class= "update_time">最終更新日時:{{ .DetailPage.UpdatedAt }}</div>
        <p></p>
      
       
        <div>いいね:<span id='likes'>{{ .DetailPage.Likes }}</span></div>
        <form id="like_form">
            <input type='hidden' name="id" value="{{ .DetailPage.Id }}">
            <input type='button' value="いいね" onclick="sendLike()">
        </form>
        <input id="input" type='hidden' value="{{ .DetailPage.Content }}">
        <div id="content"></div>
    </div>


    {{ template "footer" }}

</body>









<script type="text/javascript">
const content = document.getElementById('content')
const input = document.getElementById('input')
const likes = document.getElementById('likes')
window.addEventListener('DOMContentLoaded', function(){
    content.innerHTML = input.value
})
function sendLike(){
    
    console.log(localStorage.getItem('like'))
    var like = localStorage.getItem('like');
    
    
   
    let num=0;
    if(localStorage.getItem(like) == null){
        localStorage.setItem('like', 'true');
        num= 1;
    }else{
       
        num= 0;
    }
    console.log(localStorage.getItem('like'))
    const like_form = document.getElementById('like_form')
    const XHR = new XMLHttpRequest()
    let formdata = new FormData(like_form)
    XHR.open('POST', '/knowledges/like')
    XHR.onreadystatechange = function () {
        if (XHR.readyState === 4) {
            if (XHR.status === 200) {
                likes.textContent = Number(likes.textContent) + num
            } else {
                alert('データが正常に送れませんでした')
            }
        }
    }
    XHR.send(formdata)
}
</script>
</html>
