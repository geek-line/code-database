<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='/node_modules/materialize-css/dist/css/materialize.min.css'>
    <link rel='stylesheet' href='/node_modules/tinymce/skins/content/default/content.min.css'>
    <link rel='stylesheet' href='/node_modules/tinymce/skins/ui/oxide/content.min.css'>
    <script src="/node_modules/tinymce/tinymce.min.js" referrerpolicy="origin"></script>
</head>
<body>
    {{ template "header" .Header }}
    <h2>{{ .DetailPage.Title }}</h2>
    <img src="{{ .DetailPage.EyeCatchSrc }}" alt=''>
    <div>タグ</div>
    {{ range .DetailPage.SelectedTagNames }}
    <a href=''>{{ . }}</a>
    {{ end }}
    <div>最終更新日時:{{ .DetailPage.UpdatedAt }}</div>
    <div>いいね:<span id='likes'>{{ .DetailPage.Likes }}</span></div>
    <form id="like_form">
        <input type='hidden' name="id" value="{{ .DetailPage.Id }}">
        <input type='button' value="いいね" onclick="sendLike()">
    </form>
    <input id="input" type='hidden' value="{{ .DetailPage.Content }}">
    <div id="content"></div>
    {{ template "footer" }}
</body>
<script type="text/javascript">
const content = document.getElementById('content')
const input = document.getElementById('input')
const likes = document.getElementById('likes')
window.addEventListener('DOMContentLoaded', function(){
    content.innerHTML = input.value
})
function sendLike(){
    const like_form = document.getElementById('like_form')
    const XHR = new XMLHttpRequest()
    let formdata = new FormData(like_form)
    XHR.open('POST', '/knowledges/like')
    XHR.onreadystatechange = function () {
        if (XHR.readyState === 4) {
            if (XHR.status === 200) {
                likes.textContent = Number(likes.textContent) + 1
            } else {
                alert('データが正常に送れませんでした')
            }
        }
    }
    XHR.send(formdata)
}
</script>
</html>
